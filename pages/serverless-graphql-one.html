<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Learn how YOU can build a Serverless GraphQL API on top of a Microservice architecture, part I</title>
    <meta name="description" content="[object Object]">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <link rel="preload" href="/assets/css/0.styles.23d22851.css" as="style"><link rel="preload" href="/assets/js/app.af1af9d9.js" as="script"><link rel="preload" href="/assets/js/9.454b5262.js" as="script"><link rel="preload" href="/assets/js/4.eac68367.js" as="script"><link rel="preload" href="/assets/js/185.1c546640.js" as="script"><link rel="prefetch" href="/assets/js/1.36663999.js"><link rel="prefetch" href="/assets/js/10.50c128a6.js"><link rel="prefetch" href="/assets/js/100.832843ee.js"><link rel="prefetch" href="/assets/js/101.a0f346f6.js"><link rel="prefetch" href="/assets/js/102.d3a51c53.js"><link rel="prefetch" href="/assets/js/103.42e5967c.js"><link rel="prefetch" href="/assets/js/104.f2848816.js"><link rel="prefetch" href="/assets/js/105.975c7b9f.js"><link rel="prefetch" href="/assets/js/106.d1698fcc.js"><link rel="prefetch" href="/assets/js/107.e66c0625.js"><link rel="prefetch" href="/assets/js/108.84025cf9.js"><link rel="prefetch" href="/assets/js/109.5f1bf948.js"><link rel="prefetch" href="/assets/js/11.a104adc8.js"><link rel="prefetch" href="/assets/js/110.b06025c1.js"><link rel="prefetch" href="/assets/js/111.b728f009.js"><link rel="prefetch" href="/assets/js/112.2f202e84.js"><link rel="prefetch" href="/assets/js/113.30083b82.js"><link rel="prefetch" href="/assets/js/114.a601f1c2.js"><link rel="prefetch" href="/assets/js/115.6413aa2d.js"><link rel="prefetch" href="/assets/js/116.44cdb765.js"><link rel="prefetch" href="/assets/js/117.3fa386ab.js"><link rel="prefetch" href="/assets/js/118.8bd003cb.js"><link rel="prefetch" href="/assets/js/119.1ea9eae7.js"><link rel="prefetch" href="/assets/js/12.02e6e552.js"><link rel="prefetch" href="/assets/js/120.63c1786f.js"><link rel="prefetch" href="/assets/js/121.4f580578.js"><link rel="prefetch" href="/assets/js/122.533a0953.js"><link rel="prefetch" href="/assets/js/123.37bf1483.js"><link rel="prefetch" href="/assets/js/124.92ff020a.js"><link rel="prefetch" href="/assets/js/125.2513705b.js"><link rel="prefetch" href="/assets/js/126.ac7f0ed9.js"><link rel="prefetch" href="/assets/js/127.144659e8.js"><link rel="prefetch" href="/assets/js/128.b1c51db9.js"><link rel="prefetch" href="/assets/js/129.25930a42.js"><link rel="prefetch" href="/assets/js/13.215ad842.js"><link rel="prefetch" href="/assets/js/130.ba23dc59.js"><link rel="prefetch" href="/assets/js/131.02fed567.js"><link rel="prefetch" href="/assets/js/132.ee400e80.js"><link rel="prefetch" href="/assets/js/133.1f0c2bd1.js"><link rel="prefetch" href="/assets/js/134.8942c410.js"><link rel="prefetch" href="/assets/js/135.056c0cd5.js"><link rel="prefetch" href="/assets/js/136.6022a2fc.js"><link rel="prefetch" href="/assets/js/137.45937168.js"><link rel="prefetch" href="/assets/js/138.a9c534e4.js"><link rel="prefetch" href="/assets/js/139.37a778b2.js"><link rel="prefetch" href="/assets/js/14.1a060010.js"><link rel="prefetch" href="/assets/js/140.b40b4810.js"><link rel="prefetch" href="/assets/js/141.bc3e7a66.js"><link rel="prefetch" href="/assets/js/142.17143dc7.js"><link rel="prefetch" href="/assets/js/143.5dd23bb9.js"><link rel="prefetch" href="/assets/js/144.3bc3648b.js"><link rel="prefetch" href="/assets/js/145.ce7f777e.js"><link rel="prefetch" href="/assets/js/146.3d86f6eb.js"><link rel="prefetch" href="/assets/js/147.bf8a0bfa.js"><link rel="prefetch" href="/assets/js/148.6d6dcd45.js"><link rel="prefetch" href="/assets/js/149.8e89a8fe.js"><link rel="prefetch" href="/assets/js/15.34674cd6.js"><link rel="prefetch" href="/assets/js/150.419c0b3b.js"><link rel="prefetch" href="/assets/js/151.1902893c.js"><link rel="prefetch" href="/assets/js/152.fc680915.js"><link rel="prefetch" href="/assets/js/153.786183f8.js"><link rel="prefetch" href="/assets/js/154.30c0db9d.js"><link rel="prefetch" href="/assets/js/155.6a1f1414.js"><link rel="prefetch" href="/assets/js/156.f6a0290f.js"><link rel="prefetch" href="/assets/js/157.7e09af6b.js"><link rel="prefetch" href="/assets/js/158.34e5cfb5.js"><link rel="prefetch" href="/assets/js/159.dc9e63e0.js"><link rel="prefetch" href="/assets/js/16.119e91d4.js"><link rel="prefetch" href="/assets/js/160.45b46a8a.js"><link rel="prefetch" href="/assets/js/161.3545c817.js"><link rel="prefetch" href="/assets/js/162.61db4022.js"><link rel="prefetch" href="/assets/js/163.42fd3ede.js"><link rel="prefetch" href="/assets/js/164.8c253021.js"><link rel="prefetch" href="/assets/js/165.d5b2afe5.js"><link rel="prefetch" href="/assets/js/166.5a4d6a33.js"><link rel="prefetch" href="/assets/js/167.025f9a1f.js"><link rel="prefetch" href="/assets/js/168.dd263cd9.js"><link rel="prefetch" href="/assets/js/169.1cebceae.js"><link rel="prefetch" href="/assets/js/17.780050f1.js"><link rel="prefetch" href="/assets/js/170.eef09a30.js"><link rel="prefetch" href="/assets/js/171.568d00eb.js"><link rel="prefetch" href="/assets/js/172.13bdd851.js"><link rel="prefetch" href="/assets/js/173.ac3523e4.js"><link rel="prefetch" href="/assets/js/174.7a16fba0.js"><link rel="prefetch" href="/assets/js/175.b5970f62.js"><link rel="prefetch" href="/assets/js/176.771f1b60.js"><link rel="prefetch" href="/assets/js/177.86bf5b1e.js"><link rel="prefetch" href="/assets/js/178.9d15da32.js"><link rel="prefetch" href="/assets/js/179.2cb4394d.js"><link rel="prefetch" href="/assets/js/18.fbe87828.js"><link rel="prefetch" href="/assets/js/180.738da0ec.js"><link rel="prefetch" href="/assets/js/181.4770036a.js"><link rel="prefetch" href="/assets/js/182.0a78f9b3.js"><link rel="prefetch" href="/assets/js/183.0c345a9c.js"><link rel="prefetch" href="/assets/js/184.cf15e5be.js"><link rel="prefetch" href="/assets/js/186.d6abcecf.js"><link rel="prefetch" href="/assets/js/187.5ff401b6.js"><link rel="prefetch" href="/assets/js/188.b0882483.js"><link rel="prefetch" href="/assets/js/189.0455c7b7.js"><link rel="prefetch" href="/assets/js/19.910fc8d0.js"><link rel="prefetch" href="/assets/js/190.042d2868.js"><link rel="prefetch" href="/assets/js/191.110498b8.js"><link rel="prefetch" href="/assets/js/192.0a19375a.js"><link rel="prefetch" href="/assets/js/193.bc494463.js"><link rel="prefetch" href="/assets/js/194.f832c37a.js"><link rel="prefetch" href="/assets/js/195.e9a440c0.js"><link rel="prefetch" href="/assets/js/196.c002e70b.js"><link rel="prefetch" href="/assets/js/20.f2e93d17.js"><link rel="prefetch" href="/assets/js/21.710dadb0.js"><link rel="prefetch" href="/assets/js/22.f4b7a74b.js"><link rel="prefetch" href="/assets/js/23.7da86901.js"><link rel="prefetch" href="/assets/js/24.b2baa9f8.js"><link rel="prefetch" href="/assets/js/25.a9fce161.js"><link rel="prefetch" href="/assets/js/26.e3ef402c.js"><link rel="prefetch" href="/assets/js/27.9c9ebb3b.js"><link rel="prefetch" href="/assets/js/28.a55074a2.js"><link rel="prefetch" href="/assets/js/29.13d9e4e3.js"><link rel="prefetch" href="/assets/js/3.970a66a4.js"><link rel="prefetch" href="/assets/js/30.ad0fbce9.js"><link rel="prefetch" href="/assets/js/31.25cf2c1f.js"><link rel="prefetch" href="/assets/js/32.51b88a96.js"><link rel="prefetch" href="/assets/js/33.3cc89912.js"><link rel="prefetch" href="/assets/js/34.9e368969.js"><link rel="prefetch" href="/assets/js/35.2c5a0b70.js"><link rel="prefetch" href="/assets/js/36.e4573f18.js"><link rel="prefetch" href="/assets/js/37.63e8a86e.js"><link rel="prefetch" href="/assets/js/38.1264e174.js"><link rel="prefetch" href="/assets/js/39.94b70e03.js"><link rel="prefetch" href="/assets/js/40.d12fbfe2.js"><link rel="prefetch" href="/assets/js/41.4bb61af4.js"><link rel="prefetch" href="/assets/js/42.6ccb4ffa.js"><link rel="prefetch" href="/assets/js/43.0bd65cf1.js"><link rel="prefetch" href="/assets/js/44.0da39d02.js"><link rel="prefetch" href="/assets/js/45.89a5cd81.js"><link rel="prefetch" href="/assets/js/46.d37e8de5.js"><link rel="prefetch" href="/assets/js/47.3bc4cde3.js"><link rel="prefetch" href="/assets/js/48.ab8e19ae.js"><link rel="prefetch" href="/assets/js/49.f6392227.js"><link rel="prefetch" href="/assets/js/5.d1da013e.js"><link rel="prefetch" href="/assets/js/50.13c266ab.js"><link rel="prefetch" href="/assets/js/51.2cf06978.js"><link rel="prefetch" href="/assets/js/52.56c2b7ed.js"><link rel="prefetch" href="/assets/js/53.4d5b9ce7.js"><link rel="prefetch" href="/assets/js/54.eb903e59.js"><link rel="prefetch" href="/assets/js/55.0b31ff36.js"><link rel="prefetch" href="/assets/js/56.d346ae56.js"><link rel="prefetch" href="/assets/js/57.453c651d.js"><link rel="prefetch" href="/assets/js/58.f7fff5bb.js"><link rel="prefetch" href="/assets/js/59.a537c130.js"><link rel="prefetch" href="/assets/js/6.9bdf2d86.js"><link rel="prefetch" href="/assets/js/60.08da46b5.js"><link rel="prefetch" href="/assets/js/61.883f6c71.js"><link rel="prefetch" href="/assets/js/62.b1e24215.js"><link rel="prefetch" href="/assets/js/63.9898efdc.js"><link rel="prefetch" href="/assets/js/64.0d28ede5.js"><link rel="prefetch" href="/assets/js/65.d2e52c68.js"><link rel="prefetch" href="/assets/js/66.2e6b6c8e.js"><link rel="prefetch" href="/assets/js/67.860a252d.js"><link rel="prefetch" href="/assets/js/68.006a7e36.js"><link rel="prefetch" href="/assets/js/69.f6bbc7ee.js"><link rel="prefetch" href="/assets/js/7.8cd56b2f.js"><link rel="prefetch" href="/assets/js/70.4a3f6622.js"><link rel="prefetch" href="/assets/js/71.fd35d7b5.js"><link rel="prefetch" href="/assets/js/72.c2526cec.js"><link rel="prefetch" href="/assets/js/73.12ae69ce.js"><link rel="prefetch" href="/assets/js/74.c0c7a51b.js"><link rel="prefetch" href="/assets/js/75.25d5902a.js"><link rel="prefetch" href="/assets/js/76.7dc31228.js"><link rel="prefetch" href="/assets/js/77.da0cc43e.js"><link rel="prefetch" href="/assets/js/78.4e9609ce.js"><link rel="prefetch" href="/assets/js/79.986ee003.js"><link rel="prefetch" href="/assets/js/8.6b13a443.js"><link rel="prefetch" href="/assets/js/80.00dfb645.js"><link rel="prefetch" href="/assets/js/81.acd2f5e5.js"><link rel="prefetch" href="/assets/js/82.9cd614f2.js"><link rel="prefetch" href="/assets/js/83.1bec09df.js"><link rel="prefetch" href="/assets/js/84.1e80b79f.js"><link rel="prefetch" href="/assets/js/85.8c792b81.js"><link rel="prefetch" href="/assets/js/86.fd5f6771.js"><link rel="prefetch" href="/assets/js/87.165b1e45.js"><link rel="prefetch" href="/assets/js/88.596bd09a.js"><link rel="prefetch" href="/assets/js/89.5b99d208.js"><link rel="prefetch" href="/assets/js/90.ef8ec74a.js"><link rel="prefetch" href="/assets/js/91.11861aad.js"><link rel="prefetch" href="/assets/js/92.f68b9b5c.js"><link rel="prefetch" href="/assets/js/93.772ba160.js"><link rel="prefetch" href="/assets/js/94.35695a02.js"><link rel="prefetch" href="/assets/js/95.c89696a1.js"><link rel="prefetch" href="/assets/js/96.223a0481.js"><link rel="prefetch" href="/assets/js/97.0ad4d44e.js"><link rel="prefetch" href="/assets/js/98.68b8aba4.js"><link rel="prefetch" href="/assets/js/99.1d4527be.js">
    <link rel="stylesheet" href="/assets/css/0.styles.23d22851.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/author/" class="nav-link">Author</a></div><div class="nav-item"><a href="/articles/" class="nav-link">Blog</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/author/" class="nav-link">Author</a></div><div class="nav-item"><a href="/articles/" class="nav-link">Blog</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Learn how YOU can build a Serverless GraphQL API on top of a Microservice architecture, part I</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/serverless-graphql-one.html#resources" class="sidebar-link">Resources</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/serverless-graphql-one.html#data-structure-for-the-services" class="sidebar-link">Data structure for the services</a></li></ul></li><li><a href="/pages/serverless-graphql-one.html#creating-and-dockerizing-our-microservices" class="sidebar-link">Creating and Dockerizing our Microservices</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/serverless-graphql-one.html#dockerizing" class="sidebar-link">Dockerizing</a></li><li class="sidebar-sub-header"><a href="/pages/serverless-graphql-one.html#define-a-schema" class="sidebar-link">Define a schema</a></li><li class="sidebar-sub-header"><a href="/pages/serverless-graphql-one.html#create-services" class="sidebar-link">Create services</a></li><li class="sidebar-sub-header"><a href="/pages/serverless-graphql-one.html#trying-out-our-graphql-api" class="sidebar-link">Trying out our GraphQL API</a></li></ul></li><li><a href="/pages/serverless-graphql-one.html#summary" class="sidebar-link">Summary</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p># Learn how YOU can build a Serverless GraphQL API on top of a Microservice architecture, part I</p> <p>Follow me on <a href="https://twitter.com/chris_noring" target="_blank" rel="noopener noreferrer">Twitter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, happy to take your suggestions on topics or improvements /Chris</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/2yiee1u9l5rxy4y0eumf.jpg" alt=""></p> <blockquote><p>The idea with this article is to show how we can build microservices, dockerize them and combine them in a GraphQL API and query it from a Serverless function, how's that for a lot of buzzwords in one? 😉 <em>Microservices</em>, <em>Docker</em>, <em>GraphQL</em>, <em>Serverless</em></p></blockquote> <p>This is part of series:</p> <ul><li>Building Microservices and a GraphQL API, Part I, <strong>we are here</strong></li> <li><a href="https://dev.to/azure/learn-how-you-can-build-a-serverless-graphql-api-on-top-of-a-microservice-architecture-part-ii-deploy-it-to-the-cloud-26b6" target="_blank" rel="noopener noreferrer">Hosting the GraphQL API in a Serverless app and bring it all to the Cloud, part II<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>So, it's quite ambitious to create Microservices, Serverless and deploy to the Cloud in one article so this is a two-parter. This is part one. This part deals with Microservices and GraphQL. In part two we make it serverless and deploy it.</p> <p>In this article we will cover:</p> <ul><li><strong>GraphQL and Microservices</strong>, these are two great paradigms that really go quite well together, let's explain how</li> <li><strong>Building</strong> Microservices and Dockerizing them, let's create two micros services, each with their own areas of responsibility and let's Dockerize them</li> <li><strong>Implementing  GraphQl</strong>, we will show how we can define a GraphQL backend with schema and resolver and how to query it, of course, we will also tie in our Micro services here</li></ul> <h2 id="resources"><a href="#resources" aria-hidden="true" class="header-anchor">#</a> Resources</h2> <p>We will throw you in head first using <code>Docker</code>, <code>GraphQL</code> and some <code>Serverless</code> with Azure functions. This article is more of a recipe of what you can do with the above techniques so if you feel you need a primer on the above here is a list of posts I've written:</p> <ul><li><a href="https://dev.to/softchris/5-part-docker-series-beginner-to-master-3m1b" target="_blank" rel="noopener noreferrer">5 part series on Docker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, This covers the Basics of Docker, It includes Dockerfiles, containers,  images and Docker Compose</li> <li><a href="https://dev.to/azure/3-part-series-on-graphql-1fi1" target="_blank" rel="noopener noreferrer">3 part series on GraphQL<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, This covers the basics on GraphQL</li> <li><a href="https://azure.microsoft.com/en-gb/free/?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Free Azure Account<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> To be able to Deploy your services and host your Serverless function, you will need a free Azure account</li> <li><a href="https://dev.to/azure/serverless-from-the-beginning-using-azure-functions-vs-code-part-iii-50j7" target="_blank" rel="noopener noreferrer">Tutorial on Azure functions with VS Code<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, This post covers how to create serverless functions using VS Code</li> <li><a href="https://github.com/simonaco/serverless-graphql-workshop" target="_blank" rel="noopener noreferrer">Github repo with code to create a GraphQL API and a Serverless function<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> This article series is heavily inspired by the workshop created by my colleague <a href="https://twitter.com/simona_cotin" target="_blank" rel="noopener noreferrer">Simona Cotin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://docs.microsoft.com/en-gb/azure/containers/?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Containers in the Cloud<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, as we are about to put our containers in the Cloud in the next part in this series it can be a good idea to read up on all the offerings of Containers in the Cloud</li></ul> <p>## GraphQL and Microservices
A library and paradigm like GraphQL, is the most useful when it is able to combine different data sources into one and serve that up as one unified API. A developer of the Front end app can then query the data they need by using just one request.</p> <p>Today it becomes more common to break down a monolithic architecture into microservices, thereby you get many small APIs that works independently. GraphQL and microservices are two paradigms that go really well together. How you wonder? GraphQL is really good at describing schemas but also stitch together different APIs and the end result is something that's really useful for someone building an app as querying for data will be very simple.</p> <p>Different APIs is exactly what we have when we have a Microservices architecture. Using GraphQL on top of it all means we can reap the benefits from our chosen architecture at the same time as an App can get exactly the data it needs.</p> <p>How you wonder? Stay with me throughout this article and you will see exactly how. Bring up your code editor cause you will build it with me 😃</p> <p>## The plan
Ok, so what are we building? It's always grateful to use an e-commerce company as the target as it contains so many interesting problems for us to solve. We will zoom in on two topics in particular namely <em>products</em> and <em>reviews</em>. When it comes to <em>products</em> we need a way to keep track of what <em>products</em> we sell and all their metadata. For <em>reviews</em> we need a way to offer our customer a way to review our products, give it a <code>grade</code>, a <code>comment</code> and so on and so forth. These two concepts can be seen as two isolated islands that can be maintained and developed independently. If for example, a product gets a new description there is no reason that should affect the review of said product.</p> <p>Ok, so we turn these two concepts into <code>product service</code> and a <code>review service</code>.</p> <h3 id="data-structure-for-the-services"><a href="#data-structure-for-the-services" aria-hidden="true" class="header-anchor">#</a> Data structure for the services</h3> <p>What does the data look like for these services? Well they are in their infancy so let's assume the <code>product service</code> is a list of products for now with a product looking something like this:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[{
  id: 1,
  name: 'Avengers - infinity war',
  description: 'a Blue-ray movie'
}]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>The review service would also hold data in a list like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[{
  id: 2,
  title: 'Oh snap what an ending',
  grade: 5,
  comment: 'I need therapy after this...',
  product: 1
}]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>As you can see from the above data description the review service holds a reference to a product in the product service and it's by querying the product service that you get the <em>full picture</em> of both the review and the product involved.</p> <p>### Dockerizing
Ok, so we understand what the services need to provide in terms of a schema. The services also need to be containerized so we will describe how to build them using <code>Docker</code> a <code>Dockerfile</code> and Docker Compose.</p> <p>### GraphQL
So the GraphQL API serves as this high-level API that is able to combine results from our <code>product service</code> as well as <code>review service</code>. It's schema should look something like this:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>type Product {
   id: ID,
   name: String,
   description: String
}

type Review {
  id: ID,
  title: String,
  grade: Int,
  comment: String,
  product: Product
} 

type Query {
  products: [Product]
  reviews: [Review]
 }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>We assume that when a user of our GraphQL API queries for Reviews they want to see more than just the review but also some extra data on the Product, what's it called, what it is and so on. For that reason, we've added the <code>product</code> property on the <code>Review</code> type in the above schema so that when we drill down in our query, we are able to get both Review and Product information.</p> <p>### Serverless
So where does <em>Serverless</em> come into this? We need a way to host our API. We could be using an App Service but because our GraphQL API doesn't need to hold any state of its own and it only does a computation (it assembles a result) it makes more sense to make it a light-weight on-demand Azure Function. So that's what we are going to do 😃 As stated in the beginning we are saving this for the second part of our series, we don't want to bore you by a too lengthy article 😃</p> <h2 id="creating-and-dockerizing-our-microservices"><a href="#creating-and-dockerizing-our-microservices" aria-hidden="true" class="header-anchor">#</a> Creating and Dockerizing our Microservices</h2> <p>We opt for making these services as simple as possible so we create REST APIs using Node.js and Express, like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>/products
  app.js
  Dockerfile
  package.json
/reviews
  app.js
  Dockerfile
  package.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>The <code>app.js</code> file for <code>/products</code> looks like this:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// products/app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string">'Avengers - infinity war'</span><span class="token punctuation">,</span>
  description<span class="token punctuation">:</span> <span class="token string">'a Blue ray movie'</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Example app listening on port port!`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>and the <code>app.js</code> for <code>/reviews</code> looks like this:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>
<span class="token comment">// reviews.app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span>  <span class="token operator">||</span> <span class="token number">3000</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span>
  title<span class="token punctuation">:</span> <span class="token string">'Oh snap what an ending'</span><span class="token punctuation">,</span>
  grade<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  comment<span class="token punctuation">:</span> <span class="token string">'I need therapy after this...'</span><span class="token punctuation">,</span>
  product<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Example app listening on port port!`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Looks almost the same right? Well, we try to keep things simple for now and return static data but it's quite simple to add database later on.</p> <h3 id="dockerizing"><a href="#dockerizing" aria-hidden="true" class="header-anchor">#</a> Dockerizing</h3> <p>Before we start Dockerizing we need to install our dependency <code>Express</code> like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm install express
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This needs to be done for each service.</p> <p>Ok, we showed you in the directory for each service how there was a <code>Dockerfile</code>. It looks like this:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// Dockerfile

FROM node:latest
WORKDIR /app
ENV PORT=3000
COPY . .
RUN npm install
EXPOSE $PORT
ENTRYPOINT [&quot;npm&quot;, &quot;start&quot;]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Let's go up one level and create a <code>docker-compose.yaml</code> file, so it's easier to create our images and containers. Your file system should now look like this:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker.compose.yaml
/products
  app.js
  Dockerfile
  package.json
/reviews
  app.js
  Dockerfile
  package.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Your <code>docker-compose.yaml</code> should have the following content:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.3'
services: 
  product-service:
    build:
      context: ./products
    ports:
      - &quot;8000:3000&quot;
    networks: 
      - microservices
  review-service:
    build:
      context: ./reviews
    ports:
      - &quot;8001:3000&quot;
    networks:
      - microservices
networks: 
  microservices:
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>We can now get our service up and running with</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker-compose up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>I always feel like I'm starting up a jet engine when I run this command as all of my containers go up at the same time, so here goes, ignition 😃</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/249uosy83g8lv4soyfhk.gif" alt=""></p> <p>You should be able to find the products service at <code>http://localhost:8000</code> and the reviews service at <code>http://localhost:8001</code>. That covers the microservices for now, let's build our GraphQL API next.</p> <p>Your products service should look like the following:
<img src="https://thepracticaldev.s3.amazonaws.com/i/8gdvh8xmjzage2cnkeqs.png" alt=""></p> <p>and your review service should look like this:
<img src="https://thepracticaldev.s3.amazonaws.com/i/l1cmklaig3j0w6olr9tk.png" alt=""></p> <p>## Implementing GraphQL
There are many ways to build a GraphQL server, we could be using the raw <code>graphql</code> NPM library or the <code>express-graphql</code>, this will host our server in a Node.js Express server. Or we could be using the one from Apollo and so on. We opt for the first one <code>graphql</code> as we will ultimately serve it from a Serverless function.</p> <p>So what do we need to do:</p> <ol><li>Define a schema</li> <li>Define services we can use to resolve different parts of our schema</li> <li>Try out the API</li></ol> <h3 id="define-a-schema"><a href="#define-a-schema" aria-hidden="true" class="header-anchor">#</a> Define a schema</h3> <p>Now, this is an interesting one, we have two options here for defining a schema, either use the helper function <code>buildSchema()</code> or use the raw approach and construct our schema using primitives. For this case, we will use the raw approach and the reason for that is I simply couldn't find how to resolve things at depth using <code>buildSchema()</code> despite reading through the manual twice. It's strangely enough easily done if we were to use <code>express-graphql</code> or <code>Apollo</code> so sorry if you feel your eyes bleed a little 😉</p> <p>Ok, let's define our schema first:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// schema.js</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> 
  GraphQLSchema<span class="token punctuation">,</span>
  GraphQLObjectType<span class="token punctuation">,</span>
  GraphQLInt<span class="token punctuation">,</span>
  GraphQLNonNull<span class="token punctuation">,</span>
  GraphQLList<span class="token punctuation">,</span>
  GraphQLString
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'graphql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>
  getProducts<span class="token punctuation">,</span>
  getReviews<span class="token punctuation">,</span>
  getProduct
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./services'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> reviewType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLObjectType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Review'</span><span class="token punctuation">,</span>
  description<span class="token punctuation">:</span> <span class="token string">'A review'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">fields</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token function">GraphQLNonNull</span><span class="token punctuation">(</span>GraphQLString<span class="token punctuation">)</span><span class="token punctuation">,</span>
      description<span class="token punctuation">:</span> <span class="token string">'The id of Review.'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    title<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">,</span>
      description<span class="token punctuation">:</span> <span class="token string">'The title of the Review.'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    comment<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">,</span>
      description<span class="token punctuation">:</span> <span class="token string">'The comment of the Review.'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    grade <span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> GraphQLInt
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    product<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> productType<span class="token punctuation">,</span>
      description<span class="token punctuation">:</span> <span class="token string">'The product of the Review.'</span><span class="token punctuation">,</span>
      <span class="token function-variable function">resolve</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">review</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">getProduct</span><span class="token punctuation">(</span>review<span class="token punctuation">.</span>product<span class="token punctuation">)</span> 
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> productType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLObjectType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Product'</span><span class="token punctuation">,</span>
  description<span class="token punctuation">:</span> <span class="token string">'A product'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">fields</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token function">GraphQLNonNull</span><span class="token punctuation">(</span>GraphQLString<span class="token punctuation">)</span><span class="token punctuation">,</span>
      description<span class="token punctuation">:</span> <span class="token string">'The id of Product.'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    name<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">,</span>
      description<span class="token punctuation">:</span> <span class="token string">'The name of the Product.'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    description<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">,</span>
      description<span class="token punctuation">:</span> <span class="token string">'The description of the Product.'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> queryType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLObjectType</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Query'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">fields</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    hello<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> GraphQLString<span class="token punctuation">,</span>
      <span class="token function-variable function">resolve</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'world'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    products<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLList</span><span class="token punctuation">(</span>productType<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function-variable function">resolve</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">getProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    reviews<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLList</span><span class="token punctuation">(</span>reviewType<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function-variable function">resolve</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">getReviews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GraphQLSchema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  query<span class="token punctuation">:</span> queryType<span class="token punctuation">,</span>
  types<span class="token punctuation">:</span> <span class="token punctuation">[</span>reviewType<span class="token punctuation">,</span> productType<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br></div></div><p>Above we are defining two types <code>Review</code> and <code>Product</code> and we expose two query fields <code>products</code> and <code>reviews</code>.</p> <p>I want you to pay special attention to the variable <code>reviewType</code> and how we resolve the <code>product</code> field. Here we are resolving it like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>resolve: (review) =&gt; getProduct(review.product) 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Why do we do that? Well, it has to do with how data is stored on a Review. Let's revisit that. A Review stores its data like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  title: ''
  comment: '',
  grade: 5
  product: 1
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>As you can see above the <code>product</code> field is an integer. It's a foreign key pointing to a real product in the product service. So we need to resolve it so the API can be queried like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  reviews {
    product { 
      name
    }
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>If we don't resolve <code>product</code> to a product object instead the above query would error out.</p> <h3 id="create-services"><a href="#create-services" aria-hidden="true" class="header-anchor">#</a> Create services</h3> <p>In our <code>schema.js</code> we called methods like <code>getProducts()</code>, <code>getReviews()</code> and <code>getProduct()</code> and we need those to exist so we create a file <code>services.js</code>, like so:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> fetch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-fetch'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">getProducts</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PRODUCTS_URL</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> json <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> json<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">getProduct</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">product</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> products <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> products<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">p</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>id <span class="token operator">==</span> product<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 

<span class="token keyword">const</span> <span class="token function-variable function">getReviews</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">REVIEW_URL</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> json <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> json<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  getProducts<span class="token punctuation">,</span>
  getReviews<span class="token punctuation">,</span>
  getProduct
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>Ok, we can see above that methods <code>getProducts()</code> and <code>getReviews()</code> makes HTTP requests to URL, at least judging by the names <code>process.env.PRODUCTS_URL</code> and <code>process.env.REVIEW_URL</code>. For now, we have created a <code>.env</code> file in which we create those two env variables like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>PRODUCTS_URL = http://localhost:8000
REVIEW_URL = http://localhost:8001
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Wait, isn't that? Yes, it is. It is the URLs to <code>product service</code> and <code>review service</code> after we used <code>docker-compose</code> to bring them up. This is a great way to test your Microservice architecture locally but also prepare for deployment to the Cloud. Deploying to the Cloud is almost as simple as switching these env variables to Cloud endpoints, as you will see in the next part of this article series 😃</p> <h3 id="trying-out-our-graphql-api"><a href="#trying-out-our-graphql-api" aria-hidden="true" class="header-anchor">#</a> Trying out our GraphQL API</h3> <p>Ok, so we need to try our code out. To do that let's create an <code>app.js</code> file in which we invoke the <code>graphql()</code> function and let's provide it our schema and query, like so:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> graphql <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'graphql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> rawSchema <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./raw-schema'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dotenv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> query <span class="token operator">=</span> <span class="token template-string"><span class="token string">`{ hello products { name, description } reviews { title, comment, grade, product { name, description } } }`</span></span><span class="token punctuation">;</span>

<span class="token function">graphql</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  schema<span class="token punctuation">:</span> rawSchema<span class="token punctuation">,</span>
  source<span class="token punctuation">:</span> query
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'result'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'reviews'</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>reviews<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>In the above code, we specify a query and we expect the fields <code>hello</code>, <code>products</code> and <code>reviews</code> to come back to us and finally we invoke <code>graphql()</code> that on the <code>then()</code> callback serves up the result. The result should look like this:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/vdtbebrdrgiobwsxep8q.png" alt=""></p> <h2 id="summary"><a href="#summary" aria-hidden="true" class="header-anchor">#</a> Summary</h2> <p>We set out on a journey that would eventually lead us to the cloud. We are not there yet but part two will take us all the way. In this first part, we've managed to create microservices and dockerize them. Furthermore, we've managed to construct a GraphQL API that is able to define a schema that merges our two APIs together and serve that up.</p> <p>What remains to do, that will be the job of the second part, is to push our containers to the cloud and create service endpoints. When we have the service endpoints we can replace the value of environment variables to use the Cloud URLs instead of the localhost ones we are using now.</p> <p>Lastly, we need to scaffold a serverless function but that's all in the next part so I hope you look forward to that 😃</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.af1af9d9.js" defer></script><script src="/assets/js/9.454b5262.js" defer></script><script src="/assets/js/4.eac68367.js" defer></script><script src="/assets/js/185.1c546640.js" defer></script>
  </body>
</html>
