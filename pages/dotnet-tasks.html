<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How YOU can make your .NET programs more responsive using Tasks and async/await in .NET Core, C# and VS Code</title>
    <meta name="description" content="[object Object]">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <link rel="preload" href="/assets/css/0.styles.5ae3c088.css" as="style"><link rel="preload" href="/assets/js/app.e3a22685.js" as="script"><link rel="preload" href="/assets/js/9.454b5262.js" as="script"><link rel="preload" href="/assets/js/4.eac68367.js" as="script"><link rel="preload" href="/assets/js/160.88cccab3.js" as="script"><link rel="prefetch" href="/assets/js/1.36663999.js"><link rel="prefetch" href="/assets/js/10.dd884694.js"><link rel="prefetch" href="/assets/js/100.f7776fae.js"><link rel="prefetch" href="/assets/js/101.83c4ff25.js"><link rel="prefetch" href="/assets/js/102.d3a51c53.js"><link rel="prefetch" href="/assets/js/103.e4fd7175.js"><link rel="prefetch" href="/assets/js/104.3f860f10.js"><link rel="prefetch" href="/assets/js/105.5e05c250.js"><link rel="prefetch" href="/assets/js/106.d1698fcc.js"><link rel="prefetch" href="/assets/js/107.39206cda.js"><link rel="prefetch" href="/assets/js/108.b717e412.js"><link rel="prefetch" href="/assets/js/109.a0275c41.js"><link rel="prefetch" href="/assets/js/11.e44a9c79.js"><link rel="prefetch" href="/assets/js/110.acd428a7.js"><link rel="prefetch" href="/assets/js/111.85c1f355.js"><link rel="prefetch" href="/assets/js/112.877451fc.js"><link rel="prefetch" href="/assets/js/113.0c756607.js"><link rel="prefetch" href="/assets/js/114.2dcc568f.js"><link rel="prefetch" href="/assets/js/115.2ee55351.js"><link rel="prefetch" href="/assets/js/116.4c7211b0.js"><link rel="prefetch" href="/assets/js/117.3fa386ab.js"><link rel="prefetch" href="/assets/js/118.8bd003cb.js"><link rel="prefetch" href="/assets/js/119.eee9a7e2.js"><link rel="prefetch" href="/assets/js/12.02e6e552.js"><link rel="prefetch" href="/assets/js/120.d8458857.js"><link rel="prefetch" href="/assets/js/121.d06bb8bc.js"><link rel="prefetch" href="/assets/js/122.ad0893bf.js"><link rel="prefetch" href="/assets/js/123.37bf1483.js"><link rel="prefetch" href="/assets/js/124.92ff020a.js"><link rel="prefetch" href="/assets/js/125.88e1d9ef.js"><link rel="prefetch" href="/assets/js/126.dc6e1538.js"><link rel="prefetch" href="/assets/js/127.1a4d6785.js"><link rel="prefetch" href="/assets/js/128.4387dd5e.js"><link rel="prefetch" href="/assets/js/129.57ea763a.js"><link rel="prefetch" href="/assets/js/13.215ad842.js"><link rel="prefetch" href="/assets/js/130.58e7dbf8.js"><link rel="prefetch" href="/assets/js/131.42d28338.js"><link rel="prefetch" href="/assets/js/132.d36de42a.js"><link rel="prefetch" href="/assets/js/133.f30adb75.js"><link rel="prefetch" href="/assets/js/134.31f31974.js"><link rel="prefetch" href="/assets/js/135.28ac6845.js"><link rel="prefetch" href="/assets/js/136.fa8c6434.js"><link rel="prefetch" href="/assets/js/137.e5700d8f.js"><link rel="prefetch" href="/assets/js/138.7a324443.js"><link rel="prefetch" href="/assets/js/139.2f7c0a4b.js"><link rel="prefetch" href="/assets/js/14.1a060010.js"><link rel="prefetch" href="/assets/js/140.b91b86f6.js"><link rel="prefetch" href="/assets/js/141.96580e9a.js"><link rel="prefetch" href="/assets/js/142.0a5ba9b1.js"><link rel="prefetch" href="/assets/js/143.c459fa93.js"><link rel="prefetch" href="/assets/js/144.6c70d423.js"><link rel="prefetch" href="/assets/js/145.bb0bf891.js"><link rel="prefetch" href="/assets/js/146.6f256034.js"><link rel="prefetch" href="/assets/js/147.49ca51ce.js"><link rel="prefetch" href="/assets/js/148.2ab13d25.js"><link rel="prefetch" href="/assets/js/149.a33263c4.js"><link rel="prefetch" href="/assets/js/15.34674cd6.js"><link rel="prefetch" href="/assets/js/150.b4ba556a.js"><link rel="prefetch" href="/assets/js/151.5a70a140.js"><link rel="prefetch" href="/assets/js/152.1069f6c2.js"><link rel="prefetch" href="/assets/js/153.ecd63d9d.js"><link rel="prefetch" href="/assets/js/154.65c33956.js"><link rel="prefetch" href="/assets/js/155.6c1cd07d.js"><link rel="prefetch" href="/assets/js/156.cb9f8044.js"><link rel="prefetch" href="/assets/js/157.f967f5fd.js"><link rel="prefetch" href="/assets/js/158.1ea63677.js"><link rel="prefetch" href="/assets/js/159.6e55156d.js"><link rel="prefetch" href="/assets/js/16.119e91d4.js"><link rel="prefetch" href="/assets/js/161.71318bd8.js"><link rel="prefetch" href="/assets/js/162.c8cea25d.js"><link rel="prefetch" href="/assets/js/163.a7833ee3.js"><link rel="prefetch" href="/assets/js/164.ea1e3d74.js"><link rel="prefetch" href="/assets/js/165.e9a99c14.js"><link rel="prefetch" href="/assets/js/166.f2e26ff9.js"><link rel="prefetch" href="/assets/js/167.6a4d1f51.js"><link rel="prefetch" href="/assets/js/168.c58bc120.js"><link rel="prefetch" href="/assets/js/169.eae6e4e5.js"><link rel="prefetch" href="/assets/js/17.780050f1.js"><link rel="prefetch" href="/assets/js/170.cf5fa6a3.js"><link rel="prefetch" href="/assets/js/171.f0dd0748.js"><link rel="prefetch" href="/assets/js/172.5909c6a2.js"><link rel="prefetch" href="/assets/js/173.0682325b.js"><link rel="prefetch" href="/assets/js/174.8b371e6b.js"><link rel="prefetch" href="/assets/js/175.bdf4d597.js"><link rel="prefetch" href="/assets/js/176.5925b373.js"><link rel="prefetch" href="/assets/js/177.f678005e.js"><link rel="prefetch" href="/assets/js/178.91a77396.js"><link rel="prefetch" href="/assets/js/179.245c4e4c.js"><link rel="prefetch" href="/assets/js/18.6ebceaf1.js"><link rel="prefetch" href="/assets/js/180.aedfb4ca.js"><link rel="prefetch" href="/assets/js/181.d284539a.js"><link rel="prefetch" href="/assets/js/182.4fd4793b.js"><link rel="prefetch" href="/assets/js/183.06ee29e0.js"><link rel="prefetch" href="/assets/js/184.5493ba8e.js"><link rel="prefetch" href="/assets/js/185.6ffaf117.js"><link rel="prefetch" href="/assets/js/186.40ce91dd.js"><link rel="prefetch" href="/assets/js/187.3f8498e2.js"><link rel="prefetch" href="/assets/js/188.62070c23.js"><link rel="prefetch" href="/assets/js/189.10a10400.js"><link rel="prefetch" href="/assets/js/19.910fc8d0.js"><link rel="prefetch" href="/assets/js/190.f28d6eb5.js"><link rel="prefetch" href="/assets/js/191.846582fc.js"><link rel="prefetch" href="/assets/js/192.9904f081.js"><link rel="prefetch" href="/assets/js/193.e9a4d1b1.js"><link rel="prefetch" href="/assets/js/194.f93671b1.js"><link rel="prefetch" href="/assets/js/195.7c4863b9.js"><link rel="prefetch" href="/assets/js/196.3175eb48.js"><link rel="prefetch" href="/assets/js/197.29d26ccf.js"><link rel="prefetch" href="/assets/js/198.0402c523.js"><link rel="prefetch" href="/assets/js/199.44b5e9aa.js"><link rel="prefetch" href="/assets/js/20.f2e93d17.js"><link rel="prefetch" href="/assets/js/200.d226b6ae.js"><link rel="prefetch" href="/assets/js/201.043fccbf.js"><link rel="prefetch" href="/assets/js/202.29dec5af.js"><link rel="prefetch" href="/assets/js/203.c72e7565.js"><link rel="prefetch" href="/assets/js/21.710dadb0.js"><link rel="prefetch" href="/assets/js/22.f4b7a74b.js"><link rel="prefetch" href="/assets/js/23.fa51555f.js"><link rel="prefetch" href="/assets/js/24.95c29410.js"><link rel="prefetch" href="/assets/js/25.a9fce161.js"><link rel="prefetch" href="/assets/js/26.8b31cf1a.js"><link rel="prefetch" href="/assets/js/27.4cf46a26.js"><link rel="prefetch" href="/assets/js/28.21397a71.js"><link rel="prefetch" href="/assets/js/29.ef58c202.js"><link rel="prefetch" href="/assets/js/3.970a66a4.js"><link rel="prefetch" href="/assets/js/30.4fc73e4a.js"><link rel="prefetch" href="/assets/js/31.b2211550.js"><link rel="prefetch" href="/assets/js/32.f2e286bb.js"><link rel="prefetch" href="/assets/js/33.aec83ce9.js"><link rel="prefetch" href="/assets/js/34.9e368969.js"><link rel="prefetch" href="/assets/js/35.ccde8210.js"><link rel="prefetch" href="/assets/js/36.561677ad.js"><link rel="prefetch" href="/assets/js/37.59283e16.js"><link rel="prefetch" href="/assets/js/38.8d764594.js"><link rel="prefetch" href="/assets/js/39.94b70e03.js"><link rel="prefetch" href="/assets/js/40.ee22aa00.js"><link rel="prefetch" href="/assets/js/41.accb996e.js"><link rel="prefetch" href="/assets/js/42.dcae85a4.js"><link rel="prefetch" href="/assets/js/43.ec66ae23.js"><link rel="prefetch" href="/assets/js/44.6fc9906e.js"><link rel="prefetch" href="/assets/js/45.be8d4fd7.js"><link rel="prefetch" href="/assets/js/46.9edeab5a.js"><link rel="prefetch" href="/assets/js/47.fb12d4b7.js"><link rel="prefetch" href="/assets/js/48.52640be3.js"><link rel="prefetch" href="/assets/js/49.33d9d0c4.js"><link rel="prefetch" href="/assets/js/5.d1da013e.js"><link rel="prefetch" href="/assets/js/50.13c266ab.js"><link rel="prefetch" href="/assets/js/51.51580cbc.js"><link rel="prefetch" href="/assets/js/52.5c6157b8.js"><link rel="prefetch" href="/assets/js/53.df1e6c41.js"><link rel="prefetch" href="/assets/js/54.eb903e59.js"><link rel="prefetch" href="/assets/js/55.eb47d641.js"><link rel="prefetch" href="/assets/js/56.8246b35d.js"><link rel="prefetch" href="/assets/js/57.e6f2d2ce.js"><link rel="prefetch" href="/assets/js/58.f7fff5bb.js"><link rel="prefetch" href="/assets/js/59.1e33c33c.js"><link rel="prefetch" href="/assets/js/6.9bdf2d86.js"><link rel="prefetch" href="/assets/js/60.67ca9192.js"><link rel="prefetch" href="/assets/js/61.028819ef.js"><link rel="prefetch" href="/assets/js/62.9b98c3b5.js"><link rel="prefetch" href="/assets/js/63.efc8f547.js"><link rel="prefetch" href="/assets/js/64.ecda83e6.js"><link rel="prefetch" href="/assets/js/65.a5e5b25b.js"><link rel="prefetch" href="/assets/js/66.2e6b6c8e.js"><link rel="prefetch" href="/assets/js/67.09614dba.js"><link rel="prefetch" href="/assets/js/68.8d40a19e.js"><link rel="prefetch" href="/assets/js/69.76c62200.js"><link rel="prefetch" href="/assets/js/7.9ac2367b.js"><link rel="prefetch" href="/assets/js/70.8f3a0f45.js"><link rel="prefetch" href="/assets/js/71.4d8bdcb1.js"><link rel="prefetch" href="/assets/js/72.e816ed3a.js"><link rel="prefetch" href="/assets/js/73.d791feee.js"><link rel="prefetch" href="/assets/js/74.073c9d53.js"><link rel="prefetch" href="/assets/js/75.89cad8df.js"><link rel="prefetch" href="/assets/js/76.232ad0b0.js"><link rel="prefetch" href="/assets/js/77.49a534d4.js"><link rel="prefetch" href="/assets/js/78.134a5d5e.js"><link rel="prefetch" href="/assets/js/79.6ca3cd68.js"><link rel="prefetch" href="/assets/js/8.6b13a443.js"><link rel="prefetch" href="/assets/js/80.b733d6fd.js"><link rel="prefetch" href="/assets/js/81.4b4b8b2f.js"><link rel="prefetch" href="/assets/js/82.b53dae89.js"><link rel="prefetch" href="/assets/js/83.38d82ae3.js"><link rel="prefetch" href="/assets/js/84.7a0b2839.js"><link rel="prefetch" href="/assets/js/85.569d3ef1.js"><link rel="prefetch" href="/assets/js/86.f7c2d0fe.js"><link rel="prefetch" href="/assets/js/87.badf9ea1.js"><link rel="prefetch" href="/assets/js/88.4904c176.js"><link rel="prefetch" href="/assets/js/89.14501534.js"><link rel="prefetch" href="/assets/js/90.9f31e266.js"><link rel="prefetch" href="/assets/js/91.cd9f26cc.js"><link rel="prefetch" href="/assets/js/92.f68b9b5c.js"><link rel="prefetch" href="/assets/js/93.c0237329.js"><link rel="prefetch" href="/assets/js/94.87777679.js"><link rel="prefetch" href="/assets/js/95.7deabe56.js"><link rel="prefetch" href="/assets/js/96.8ac1aaf0.js"><link rel="prefetch" href="/assets/js/97.0ad4d44e.js"><link rel="prefetch" href="/assets/js/98.6406ef0c.js"><link rel="prefetch" href="/assets/js/99.9fedc5bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5ae3c088.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/author/" class="nav-link">Author</a></div><div class="nav-item"><a href="/articles/" class="nav-link">Blog</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/author/" class="nav-link">Author</a></div><div class="nav-item"><a href="/articles/" class="nav-link">Blog</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>How YOU can make your .NET programs more responsive using Tasks and async/await in .NET Core, C# and VS Code</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/dotnet-tasks.html#references" class="sidebar-link">References</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/dotnet-tasks.html#what" class="sidebar-link">WHAT</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/dotnet-tasks.html#why" class="sidebar-link">WHY</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/dotnet-tasks.html#demo" class="sidebar-link">DEMO</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/dotnet-tasks.html#scaffold-a-project" class="sidebar-link">Scaffold a project</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-tasks.html#authoring-methods" class="sidebar-link">Authoring methods</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-tasks.html#control-flow" class="sidebar-link">Control flow</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-tasks.html#using-async-apis" class="sidebar-link">Using Async APIs</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-tasks.html#full-code" class="sidebar-link">Full code</a></li></ul></li><li><a href="/pages/dotnet-tasks.html#summary" class="sidebar-link">Summary</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="how-you-can-make-your-net-programs-more-responsive-using-tasks-and-async-await-in-net-core-c-and-vs-code"><a href="#how-you-can-make-your-net-programs-more-responsive-using-tasks-and-async-await-in-net-core-c-and-vs-code" aria-hidden="true" class="header-anchor">#</a> How YOU can make your .NET programs more responsive using Tasks and async/await in .NET Core, C# and VS Code</h1> <p>Follow me on <a href="https://twitter.com/chris_noring" target="_blank" rel="noopener noreferrer">Twitter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, happy to take your suggestions on topics or improvements /Chris</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/0yr9tckstlb2m5re3c4u.jpg" alt=""></p> <blockquote><p>When we run synchronous code we block the main Thread from doing anything else than just what's it's doing currently. This makes your software and user experience slower than it needs to be.</p></blockquote> <p>TLDR; we have the concept of Threads in .NET/.NET Core and they are an excellent way to schedule work to be carried out in parallel. However, they might be cumbersome to use. There is, however, a library called TPL, <strong>T</strong>ask <strong>P</strong>arallel <strong>L</strong>ibrary that lives on top of the Thread model and makes it really easy to schedule and manage work.</p> <h2 id="references"><a href="#references" aria-hidden="true" class="header-anchor">#</a> References</h2> <ul><li><p><a href="https://docs.microsoft.com/dotnet/csharp/programming-guide/concepts/async/async-return-types?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Async return types<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
It gives you a good intro to Tasks.</p></li> <li><p><a href="https://docs.microsoft.com/dotnet/csharp/programming-guide/concepts/async/control-flow-in-async-programs?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Task Control Flows<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
This talks about Control flows, how to ensure that the code happens in the right order</p></li> <li><p><a href="https://docs.microsoft.com/dotnet/standard/parallel-programming/task-based-asynchronous-programming?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Task Based Asynchronous programming<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
This is more of an overview of Task-based programming</p></li> <li><p><a href="https://docs.microsoft.com/dotnet/standard/parallel-programming/chaining-tasks-by-using-continuation-tasks?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">How to run Tasks sequentially<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
This talks about how to run Tasks in order, one after another.</p></li> <li><p><a href="https://docs.microsoft.com/dotnet/standard/parallel-programming/task-cancellation?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Task Cancellation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
This teaches you how to cancel and listen for cancellation messages for your tasks</p></li> <li><p><a href="https://docs.microsoft.com/azure/azure-functions/durable/durable-functions-overview?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">Durable Functions in Azure<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
This shows how to do Tasks in Serverless programming and specifically Durable Functions</p></li> <li><p><a href="https://docs.microsoft.com/dotnet/csharp/programming-guide/concepts/async/walkthrough-accessing-the-web-by-using-async-and-await?wt.mc_id=personal-blog-chnoring" target="_blank" rel="noopener noreferrer">A Recipe converting sync code to async<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
This takes you all the way from synchronous code to gradually convert it to asynchronous code.</p></li></ul> <h2 id="what"><a href="#what" aria-hidden="true" class="header-anchor">#</a> WHAT</h2> <p>So we mentioned TPL as a library. What do we need to know? TPL is such a central and important concept that it lives in the core APIs. It's part of the <code>System.Threading</code> and <code>System.Threading.Tasks</code> namespaces. It does a lot for us like:</p> <ul><li><strong>Partitioning</strong> of the work</li> <li><strong>Scheduling</strong> of threads on the <code>ThreadPool</code></li> <li><strong>Cancellation</strong> support</li> <li><strong>State</strong> management</li></ul> <p>and other low-level details.</p> <p>There are some basic concepts that we need to understand.</p> <ul><li><strong>Task</strong>, a task represent an asynchronous operation, like fetching content from a file or doing a calculation that takes time. There are some interesting properties on a Task that allows us to communicate to a UI, for example, how the asynchronous work is doing, like:
<ul><li><strong>Status</strong>, this can tell us if it's currently working on something, is done, errored out or it was canceled</li> <li><strong>IsCanceled</strong>, if canceled this would be set to <code>true</code></li> <li><strong>IsFaulted</strong>, if something went wrong, like an exception, this would be set to <code>true</code></li> <li><strong>IsCompleted</strong>, once it has finished its operation it would be set to <code>true</code></li></ul></li> <li><strong>Async/Await</strong>. The <code>await</code> keyword means that we finish for the asynchronous operation to end and by the end of the operation we are given the result, e.g <code>var fileContent = await GetFileAsync()</code>. Any method that uses the <code>await</code> concept would need to have <code>async</code> keyword as part of the method header.</li> <li><strong>Blocking/Non-blocking</strong>. When we use Tasks we are not blocking and other Threads can carry out work. There are exceptions though when we use the method <code>Wait()</code> on a Task we are forcing the code to run synchronously. We will show that in our demo in the next section.</li></ul> <h2 id="why"><a href="#why" aria-hidden="true" class="header-anchor">#</a> WHY</h2> <p>A lot of things like opening up large files or carrying out a Web Request or maybe searching through your computer - are things that can be done in <em>parallel</em>. This means you can return back to the user much faster with a result and your app will be perceived as faster and more responsive. Web Development already uses the concept of <em>Tasks</em> heavily, which is a central concept in TPL. Learning how to use TPL can really make your applications more responsive. My hope is that you with this article feel more empowered to use TPL and Tasks.</p> <h2 id="demo"><a href="#demo" aria-hidden="true" class="header-anchor">#</a> DEMO</h2> <p>In our Demo we will demonstrate the following:</p> <ul><li><strong>Authoring</strong> methods, How to author methods using <code>async/await</code> and how to return different types</li> <li><strong>Control flow</strong>, we will show how to wait for all as well as specific Tasks</li> <li><strong>Blocking code</strong>, we will show how the usage of <code>Result</code> as well as <code>Wait()</code> affects your code</li></ul> <h3 id="scaffold-a-project"><a href="#scaffold-a-project" aria-hidden="true" class="header-anchor">#</a> Scaffold a project</h3> <p>Let's start by creating a solution like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir tasks
cd tasks

dotnet new sln
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>This should create a solution file.</p> <p>Next, we will create a console project like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dotnet new solution -o task-demo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>and now add it to the solution like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dotnet sln add task-demo/task-demo.csproj
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Ok, we are ready to start coding. Open up an IDE, I'm gonna go with VS Code.</p> <h3 id="authoring-methods"><a href="#authoring-methods" aria-hidden="true" class="header-anchor">#</a> Authoring methods</h3> <p>Let's open up the file <code>Program.cs</code> and add the following method inside of the class <code>Program</code>:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">Sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>There are some interesting things that go on above:</p> <ul><li><strong>Return type</strong>, <code>Task&lt;int&gt;</code>. This tells us that it will be a Task that once resolved will return something of type <code>int</code>.</li> <li><code>Task.FromResult()</code>, This creates a Task given a value. We give it the calculation to perform, e.g <code>a+b</code>.</li> <li><strong>Async/Await</strong>, We can see how we use the <code>async</code> keyword inside of the method to wait for the result to arrive back to us. This needs to be followed by the <code>async</code> keyword to ensure the compiler is happy.</li></ul> <p>It's easy to think that the above method above doesn't need to be asynchronous but imagine instead that this is a calculation that takes time, then it would make more sense.</p> <h3 id="control-flow"><a href="#control-flow" aria-hidden="true" class="header-anchor">#</a> Control flow</h3> <p>There's more to Tasks than just marking them <code>async</code>. We can ensure to wait for <em>all</em> or some of the tasks to finish before carrying on with our code. We have some constructs that help us control this flow:</p> <ul><li><code>Task.WaitAll()</code>, this one takes a list of Tasks in. What you are essentially saying is that all tasks need to finish before we can carry on, it's blocking. You can see that by it returning <code>void</code>
A typical use-case is to wait for all Web Requests to finish cause we want to return a result that consists of us stitching all their data together</li> <li><code>Task.WaitAny()</code>, we give it a list of Tasks here as well but the meaning is different. We say that as long as any of the Task has finished we are good. This usually a race for data towards an endpoint or search for a file/file content on a disk. We don't care how finished first, as long as we get <em>a response</em>. This is also blocking and waiting for one of the Tasks to finish</li> <li><code>Task.WhenAll()</code>, this gives you a <code>Task</code> back that you can interact with. When all of the tasks have finished it will resolve.</li> <li><code>Task.WhenAny()</code>, this gives you a <code>Task</code> back that you can interact with. When one of the Tasks has finished then it will resolve.</li></ul> <p>Let's create a demo of a Control flow. We will fake carrying out time-consuming work by adding an additional method to our class, like so:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token class-name">Task</span> <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>Demo - Control flow</strong></p> <p>Now we can add some control flow code in our <code>Main()</code> method like so:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> start  <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>

<span class="token keyword">var</span> taskSum <span class="token operator">=</span> <span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> taskDelay <span class="token operator">=</span> <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Task<span class="token punctuation">.</span><span class="token function">WaitAll</span><span class="token punctuation">(</span>taskSum<span class="token punctuation">,</span> taskDelay<span class="token punctuation">)</span><span class="token punctuation">;</span>

end <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Time taken {0}&quot;</span><span class="token punctuation">,</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>Our full code in <code>Program.cs</code> should now look like this:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> task_demo
<span class="token punctuation">{</span>
    <span class="token keyword">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token class-name">Task</span> <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">Sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> 
        <span class="token punctuation">{</span>
            <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">var</span> start  <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>

            <span class="token keyword">var</span> taskSum <span class="token operator">=</span> <span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> taskDelay <span class="token operator">=</span> <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Task<span class="token punctuation">.</span><span class="token function">WaitAll</span><span class="token punctuation">(</span>taskSum<span class="token punctuation">,</span> taskDelay<span class="token punctuation">)</span><span class="token punctuation">;</span>

            end <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>

            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Time taken! {0}&quot;</span><span class="token punctuation">,</span> end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>Let' compile:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dotnet build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>and run it:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dotnet run
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>We should get the following response:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>4
Time taken! 00:00:02.0026920
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Even though the calculation from calling <code>Sum()</code> took a few milliseconds, we don't get any response until 2 seconds later, when <code>DoSomething()</code> has finished.</p> <p>If we shift our code now from <code>WaitAll</code> to <code>WhenAll</code> we would get very different behavior. The code would have kept going and reported this instead:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>4
Time taken! 00:00:00.0235860
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>So the lesson here is that if we want the code to wait at a specific point, using <code>WaitAny</code> is a good idea but if you want to start up a lot of asynchronous work then use <code>When...</code>.</p> <p>We can still make the code behave correctly with <code>WhenAll</code> but we would need to investigate the status like so:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> twoTasks <span class="token operator">=</span> Task<span class="token punctuation">.</span><span class="token function">WhenAll</span><span class="token punctuation">(</span>taskSum<span class="token punctuation">,</span> taskDelay<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>twoTasks<span class="token punctuation">.</span>IsCompleted<span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> end <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span> taskSum<span class="token punctuation">.</span>Result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>DEMO - Wait any</strong></p> <p>To test this one out we create three new methods that mock opening up files. Each of the three methods has a delay built in that differs:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> <span class="token function">ReadFile1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;file1&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> <span class="token function">ReadFile2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;file2&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> <span class="token function">ReadFile3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;file3&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Let's update our <code>Program()</code> method with some code as well:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> task1 <span class="token operator">=</span> <span class="token function">ReadFile1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> task2 <span class="token operator">=</span> <span class="token function">ReadFile2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> task3 <span class="token operator">=</span> <span class="token function">ReadFile3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

start <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
Task<span class="token punctuation">.</span><span class="token function">WaitAny</span><span class="token punctuation">(</span>task1<span class="token punctuation">,</span> task2<span class="token punctuation">,</span> task3<span class="token punctuation">)</span><span class="token punctuation">;</span>


Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Task1, completed: {0}&quot;</span><span class="token punctuation">,</span> task1<span class="token punctuation">.</span>IsCompleted<span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Task2, completed: {0}&quot;</span><span class="token punctuation">,</span> task2<span class="token punctuation">.</span>IsCompleted<span class="token punctuation">)</span><span class="token punctuation">;</span>

Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Task3, completed: {0}&quot;</span><span class="token punctuation">,</span> task3<span class="token punctuation">.</span>IsCompleted<span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Task3, completed: {0}&quot;</span><span class="token punctuation">,</span> task3<span class="token punctuation">.</span>Result<span class="token punctuation">)</span><span class="token punctuation">;</span>

end <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Time taken! {0}&quot;</span><span class="token punctuation">,</span> end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>As you can see above, we are waiting for one of the three tasks to finish, with this construct:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>Task<span class="token punctuation">.</span><span class="token function">WaitAny</span><span class="token punctuation">(</span>task1<span class="token punctuation">,</span> task2<span class="token punctuation">,</span> task3<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Given what we know of the methods being called, <code>ReadFile3()</code> should finish first, after <code>2</code> seconds, but let's test that by running our program:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Task1, completed: False
Task2, completed: False
Task3, completed: True
Task3, completed: file3
Time taken! 00:00:02.0031370
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>We can see above that <code>Task3</code> is completed and the other tasks haven't completed yet.</p> <h3 id="using-async-apis"><a href="#using-async-apis" aria-hidden="true" class="header-anchor">#</a> Using Async APIs</h3> <p>Ok, we now understand more about async and is able to leverage that on existing APIs. Let's look at reading the content of a file. Normally you would create a method like so:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token keyword">string</span> <span class="token function">ReadTxtFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">using</span><span class="token punctuation">(</span><span class="token keyword">var</span> sr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StreamReader</span><span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sr<span class="token punctuation">.</span><span class="token function">ReadToEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>The above would block though and you wouldn't be able to do much else while this finishes. Imagine this is a really large file then it would be really noticeable. If we rewrite the method to use an <em>async</em> version we would instead get code looking like this:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code> <span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> <span class="token function">ReadTxtFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token keyword">using</span><span class="token punctuation">(</span><span class="token keyword">var</span> sr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StreamReader</span><span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">await</span> sr<span class="token punctuation">.</span><span class="token function">ReadToEndAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>This doesn't block and everyone is happy.</p> <p>### Blocking code</p> <p>One of the tricky parts of using TPL is knowing what calls block. You are all happy that your code is now asynchronous but suddenly you end up blocking anyway. So what shall we look out for? Well, we touched upon this subject already:</p> <ul><li><code>WaitAll</code> and <code>WaitAny</code> blocks, the rule of thumb here seems to be that they return void and use the word <em>Wait...</em>. Sometimes you want it to wait though, so learn to be intentional with block/non-block</li> <li><code>task.Result</code>, this also blocks and waits for the result to be available</li> <li><code>Wait()</code>, this method on a Task will block and cause you to wait here until the code has finished, for example <code>Task.Delay(2000).Wait()</code></li></ul> <h3 id="full-code"><a href="#full-code" aria-hidden="true" class="header-anchor">#</a> Full code</h3> <p>This is the full code I was playing around with if you want to explore for yourself:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>IO<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> task_demo
<span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Program</span>
  <span class="token punctuation">{</span>
      <span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> <span class="token function">ReadTxtFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
      <span class="token punctuation">{</span>
          <span class="token keyword">using</span><span class="token punctuation">(</span><span class="token keyword">var</span> sr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StreamReader</span><span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;test.txt&quot;</span><span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token keyword">await</span> sr<span class="token punctuation">.</span><span class="token function">ReadToEndAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">static</span> <span class="token keyword">string</span> <span class="token function">ReadFileSync1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
      <span class="token punctuation">{</span>
          Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token string">&quot;content1&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">static</span> <span class="token keyword">string</span> <span class="token function">ReadFileSync2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
          Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token string">&quot;content2&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">static</span> <span class="token keyword">string</span> <span class="token function">ReadFileSync3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">{</span>
          Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token string">&quot;content3&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      
      <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token class-name">Task</span> <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
          <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token function">Sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> 
      <span class="token punctuation">{</span>
          <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">FromResult</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> result<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> <span class="token function">ReadFile1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
      <span class="token punctuation">{</span>
          <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token string">&quot;file1&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> <span class="token function">ReadFile2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
          <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token string">&quot;file2&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">static</span> <span class="token keyword">async</span> Task<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> <span class="token function">ReadFile3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
          <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token string">&quot;file3&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
          <span class="token keyword">var</span> start <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
          <span class="token keyword">var</span> c1 <span class="token operator">=</span> <span class="token function">ReadFileSync1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> c2 <span class="token operator">=</span> <span class="token function">ReadFileSync2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> c3 <span class="token operator">=</span> <span class="token function">ReadFileSync3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> end <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Time taken {0}&quot;</span><span class="token punctuation">,</span> end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>

          start  <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>

          <span class="token keyword">var</span> taskSum <span class="token operator">=</span> <span class="token function">Sum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> taskDelay <span class="token operator">=</span> <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          Task<span class="token punctuation">.</span><span class="token function">WaitAll</span><span class="token punctuation">(</span>taskSum<span class="token punctuation">,</span> taskDelay<span class="token punctuation">)</span><span class="token punctuation">;</span>

          end <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>

          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0}&quot;</span><span class="token punctuation">,</span>taskSum<span class="token punctuation">.</span>Result<span class="token punctuation">)</span><span class="token punctuation">;</span>

          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Time taken! {0}&quot;</span><span class="token punctuation">,</span> end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token keyword">var</span> task1 <span class="token operator">=</span> <span class="token function">ReadFile1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> task2 <span class="token operator">=</span> <span class="token function">ReadFile2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> task3 <span class="token operator">=</span> <span class="token function">ReadFile3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          start <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
          Task<span class="token punctuation">.</span><span class="token function">WaitAny</span><span class="token punctuation">(</span>task1<span class="token punctuation">,</span> task2<span class="token punctuation">,</span> task3<span class="token punctuation">)</span><span class="token punctuation">;</span>
          
          
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Task1, completed: {0}&quot;</span><span class="token punctuation">,</span> task1<span class="token punctuation">.</span>IsCompleted<span class="token punctuation">)</span><span class="token punctuation">;</span>
          
          <span class="token comment">// this forces everyone to wait for this Task1</span>
          <span class="token comment">// Console.WriteLine(&quot;Task1, completed: {0}&quot;, task1.Result);</span>

          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Task2, completed: {0}&quot;</span><span class="token punctuation">,</span> task2<span class="token punctuation">.</span>IsCompleted<span class="token punctuation">)</span><span class="token punctuation">;</span>

          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Task3, completed: {0}&quot;</span><span class="token punctuation">,</span> task3<span class="token punctuation">.</span>IsCompleted<span class="token punctuation">)</span><span class="token punctuation">;</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Task3, completed: {0}&quot;</span><span class="token punctuation">,</span> task3<span class="token punctuation">.</span>Result<span class="token punctuation">)</span><span class="token punctuation">;</span>

          end <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">;</span>
          Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Time taken! {0}&quot;</span><span class="token punctuation">,</span> end <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br></div></div><h2 id="summary"><a href="#summary" aria-hidden="true" class="header-anchor">#</a> Summary</h2> <p>In summary, we learned about the concept of Tasks and their anatomy. Additionally, we learned about Control Flows and we also discussed blocking/non-blocking code. There is more to learn though like how to cancel Tasks. Im gonna save that one for a separate article. I will add a link to Cancellation in the References section of this article.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e3a22685.js" defer></script><script src="/assets/js/9.454b5262.js" defer></script><script src="/assets/js/4.eac68367.js" defer></script><script src="/assets/js/160.88cccab3.js" defer></script>
  </body>
</html>
