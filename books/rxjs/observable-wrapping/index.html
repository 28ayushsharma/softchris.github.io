<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Observable wrapping</title>
    <meta name="description" content="">
    <head link="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.17.1/components/prism-abap.js"></head>
    
    <link rel="preload" href="/assets/css/0.styles.b5ff879b.css" as="style"><link rel="preload" href="/assets/js/app.64faaba4.js" as="script"><link rel="preload" href="/assets/js/10.da81cb77.js" as="script"><link rel="preload" href="/assets/js/77.58b772a8.js" as="script"><link rel="prefetch" href="/assets/js/1.76e1fa2c.js"><link rel="prefetch" href="/assets/js/100.c589a231.js"><link rel="prefetch" href="/assets/js/101.2f1a7b93.js"><link rel="prefetch" href="/assets/js/102.098e17e9.js"><link rel="prefetch" href="/assets/js/103.4975ea9e.js"><link rel="prefetch" href="/assets/js/104.23238ecf.js"><link rel="prefetch" href="/assets/js/105.1dcb1f53.js"><link rel="prefetch" href="/assets/js/106.a74e4899.js"><link rel="prefetch" href="/assets/js/107.4141228d.js"><link rel="prefetch" href="/assets/js/108.a7da2304.js"><link rel="prefetch" href="/assets/js/109.79542487.js"><link rel="prefetch" href="/assets/js/11.f6d86a0a.js"><link rel="prefetch" href="/assets/js/110.3bfa8d2d.js"><link rel="prefetch" href="/assets/js/111.6b1c3a38.js"><link rel="prefetch" href="/assets/js/112.31ab7f6a.js"><link rel="prefetch" href="/assets/js/113.39958547.js"><link rel="prefetch" href="/assets/js/114.6e89614e.js"><link rel="prefetch" href="/assets/js/115.9709465d.js"><link rel="prefetch" href="/assets/js/116.5f1efef5.js"><link rel="prefetch" href="/assets/js/117.2943eb77.js"><link rel="prefetch" href="/assets/js/118.eaee3335.js"><link rel="prefetch" href="/assets/js/119.ef03ebde.js"><link rel="prefetch" href="/assets/js/12.0ed640a1.js"><link rel="prefetch" href="/assets/js/120.b01e2e7d.js"><link rel="prefetch" href="/assets/js/121.8a233b9d.js"><link rel="prefetch" href="/assets/js/122.fd7e8414.js"><link rel="prefetch" href="/assets/js/123.24becd1d.js"><link rel="prefetch" href="/assets/js/124.136ebb96.js"><link rel="prefetch" href="/assets/js/125.1bd4ae7e.js"><link rel="prefetch" href="/assets/js/126.97c29f6d.js"><link rel="prefetch" href="/assets/js/127.dc012847.js"><link rel="prefetch" href="/assets/js/128.1233ccbb.js"><link rel="prefetch" href="/assets/js/129.3ee8de1a.js"><link rel="prefetch" href="/assets/js/13.8d8ebce3.js"><link rel="prefetch" href="/assets/js/130.0ac02305.js"><link rel="prefetch" href="/assets/js/131.7d31bb28.js"><link rel="prefetch" href="/assets/js/132.ed96f803.js"><link rel="prefetch" href="/assets/js/133.7ea68fb0.js"><link rel="prefetch" href="/assets/js/14.28cc3d33.js"><link rel="prefetch" href="/assets/js/15.e392c70f.js"><link rel="prefetch" href="/assets/js/16.019de8ce.js"><link rel="prefetch" href="/assets/js/17.957ef588.js"><link rel="prefetch" href="/assets/js/18.4ab7403e.js"><link rel="prefetch" href="/assets/js/19.ae2840ee.js"><link rel="prefetch" href="/assets/js/20.09f9c6ec.js"><link rel="prefetch" href="/assets/js/21.4b8a4546.js"><link rel="prefetch" href="/assets/js/22.ddc02800.js"><link rel="prefetch" href="/assets/js/23.0e4c2671.js"><link rel="prefetch" href="/assets/js/24.297c5891.js"><link rel="prefetch" href="/assets/js/25.1af9b315.js"><link rel="prefetch" href="/assets/js/26.75dd9db7.js"><link rel="prefetch" href="/assets/js/27.dcb00858.js"><link rel="prefetch" href="/assets/js/28.a4db86ee.js"><link rel="prefetch" href="/assets/js/29.67e6be62.js"><link rel="prefetch" href="/assets/js/3.95140222.js"><link rel="prefetch" href="/assets/js/30.6fc7edf6.js"><link rel="prefetch" href="/assets/js/31.2f6479c3.js"><link rel="prefetch" href="/assets/js/32.c8754095.js"><link rel="prefetch" href="/assets/js/33.6407b065.js"><link rel="prefetch" href="/assets/js/34.079ab50d.js"><link rel="prefetch" href="/assets/js/35.e55eb594.js"><link rel="prefetch" href="/assets/js/36.5fb6f635.js"><link rel="prefetch" href="/assets/js/37.dffe088c.js"><link rel="prefetch" href="/assets/js/38.eda2d132.js"><link rel="prefetch" href="/assets/js/39.64d08d4e.js"><link rel="prefetch" href="/assets/js/4.b33b06f6.js"><link rel="prefetch" href="/assets/js/40.829865ee.js"><link rel="prefetch" href="/assets/js/41.41a0b35e.js"><link rel="prefetch" href="/assets/js/42.2e45af8c.js"><link rel="prefetch" href="/assets/js/43.97f316fa.js"><link rel="prefetch" href="/assets/js/44.a5a36f06.js"><link rel="prefetch" href="/assets/js/45.5f05df22.js"><link rel="prefetch" href="/assets/js/46.838bca78.js"><link rel="prefetch" href="/assets/js/47.08acdd89.js"><link rel="prefetch" href="/assets/js/48.37d13c93.js"><link rel="prefetch" href="/assets/js/49.40bc9c85.js"><link rel="prefetch" href="/assets/js/5.44d1fb4e.js"><link rel="prefetch" href="/assets/js/50.f591266f.js"><link rel="prefetch" href="/assets/js/51.4755e4eb.js"><link rel="prefetch" href="/assets/js/52.074dc62a.js"><link rel="prefetch" href="/assets/js/53.27264aee.js"><link rel="prefetch" href="/assets/js/54.8df7a1ee.js"><link rel="prefetch" href="/assets/js/55.a19a07a1.js"><link rel="prefetch" href="/assets/js/56.980cd8bc.js"><link rel="prefetch" href="/assets/js/57.2195c93a.js"><link rel="prefetch" href="/assets/js/58.0db32467.js"><link rel="prefetch" href="/assets/js/59.99836c77.js"><link rel="prefetch" href="/assets/js/6.67cc1f3f.js"><link rel="prefetch" href="/assets/js/60.65687893.js"><link rel="prefetch" href="/assets/js/61.b82ca20d.js"><link rel="prefetch" href="/assets/js/62.2b545ed7.js"><link rel="prefetch" href="/assets/js/63.122cc7d0.js"><link rel="prefetch" href="/assets/js/64.2eb6f4f7.js"><link rel="prefetch" href="/assets/js/65.8cb89e69.js"><link rel="prefetch" href="/assets/js/66.9463b112.js"><link rel="prefetch" href="/assets/js/67.2c3dbba6.js"><link rel="prefetch" href="/assets/js/68.42484148.js"><link rel="prefetch" href="/assets/js/69.51019aca.js"><link rel="prefetch" href="/assets/js/7.3a1e5376.js"><link rel="prefetch" href="/assets/js/70.0aec8627.js"><link rel="prefetch" href="/assets/js/71.74a35c0b.js"><link rel="prefetch" href="/assets/js/72.a0b63b3e.js"><link rel="prefetch" href="/assets/js/73.9440284c.js"><link rel="prefetch" href="/assets/js/74.991d7995.js"><link rel="prefetch" href="/assets/js/75.49eaff04.js"><link rel="prefetch" href="/assets/js/76.ab8bb587.js"><link rel="prefetch" href="/assets/js/78.0b403c34.js"><link rel="prefetch" href="/assets/js/79.db27e6ad.js"><link rel="prefetch" href="/assets/js/8.988484b0.js"><link rel="prefetch" href="/assets/js/80.55330d6f.js"><link rel="prefetch" href="/assets/js/81.f120685c.js"><link rel="prefetch" href="/assets/js/82.c087fc42.js"><link rel="prefetch" href="/assets/js/83.a7304e4c.js"><link rel="prefetch" href="/assets/js/84.765a3ca9.js"><link rel="prefetch" href="/assets/js/85.5008f347.js"><link rel="prefetch" href="/assets/js/86.00e06228.js"><link rel="prefetch" href="/assets/js/87.eb487e27.js"><link rel="prefetch" href="/assets/js/88.8c938221.js"><link rel="prefetch" href="/assets/js/89.ccb0706f.js"><link rel="prefetch" href="/assets/js/9.20ba5650.js"><link rel="prefetch" href="/assets/js/90.7d16710e.js"><link rel="prefetch" href="/assets/js/91.01a2b93a.js"><link rel="prefetch" href="/assets/js/92.02feeef1.js"><link rel="prefetch" href="/assets/js/93.79a68154.js"><link rel="prefetch" href="/assets/js/94.cb30ec7c.js"><link rel="prefetch" href="/assets/js/95.71a2f6ce.js"><link rel="prefetch" href="/assets/js/96.9e9cf436.js"><link rel="prefetch" href="/assets/js/97.284bec90.js"><link rel="prefetch" href="/assets/js/98.1ab6d2ff.js"><link rel="prefetch" href="/assets/js/99.2296039f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b5ff879b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="book-layout" data-v-4d6ae5a9><div class="left" data-v-4d6ae5a9><div class="book-detail" data-v-d992904e data-v-4d6ae5a9><div data-v-d992904e><div data-v-d992904e><!----> <!----></div> <div data-v-d992904e>
      
    </div></div><div data-v-d992904e><div class="depth1" data-v-d992904e><!----> <span data-v-d992904e>Basics</span></div> <div data-v-d992904e>
      
    </div></div><div data-v-d992904e><div class="depth2" data-v-d992904e><a href="/books/rxjs/async/" class="title" data-v-d992904e>Async code</a> <!----></div> <div data-v-d992904e>
      
    </div></div><div data-v-d992904e><div class="depth2" data-v-d992904e><a href="/books/rxjs/why-rxjs/" class="title" data-v-d992904e>Why RxJS</a> <!----></div> <div data-v-d992904e>
      
    </div></div><div data-v-d992904e><div class="depth2" data-v-d992904e><a href="/books/rxjs/installation-setup/" class="title" data-v-d992904e>Installation and Setup</a> <!----></div> <div data-v-d992904e>
      
    </div></div><div data-v-d992904e><div class="depth1" data-v-d992904e><!----> <span data-v-d992904e>Observables</span></div> <div data-v-d992904e>
      
    </div></div><div data-v-d992904e><div class="depth2" data-v-d992904e><a href="/books/rxjs/observable-anatomy/" class="title" data-v-d992904e>Observable Anatomy</a> <!----></div> <div data-v-d992904e>
      
    </div></div><div data-v-d992904e><div class="depth2" data-v-d992904e><a href="/books/rxjs/observer/" class="title" data-v-d992904e>Observer</a> <!----></div> <div data-v-d992904e>
      
    </div></div><div data-v-d992904e><div class="depth2" data-v-d992904e><a href="/books/rxjs/producer/" class="title" data-v-d992904e>Producer</a> <!----></div> <div data-v-d992904e>
      
    </div></div><div data-v-d992904e><div class="depth2" data-v-d992904e><a href="/books/rxjs/observable-vs-promise/" class="title" data-v-d992904e>Observable vs Promise</a> <!----></div> <div data-v-d992904e>
      
    </div></div><div data-v-d992904e><div class="depth2 selected" data-v-d992904e><a href="/books/rxjs/observable-wrapping/" class="title selected" data-v-d992904e>Observable wrapping</a> <!----></div> <div data-v-d992904e>
      
    </div></div></div></div> <div class="right theme-default-content" data-v-4d6ae5a9><div class="content__default" data-v-4d6ae5a9><h1 id="observable-wrapping"><a href="#observable-wrapping" aria-hidden="true" class="header-anchor">#</a> Observable wrapping</h1> <blockquote><p>NOTE, this code is not using the new <em>pipeable</em> syntax and will need to be updated at some point. However, there is a great learning opportunity in looking at a longer RxJS example</p></blockquote> <p>We have just learned in <em>Observable Anatomy</em> that the key operators <code>next()</code> , <code>error()</code> and <code>complete</code> is what makes our Observable tick, if we define it ourselves. We have also learned that these methods triggers a corresponding callback on our subscription.</p> <p>Wrapping something in an observable means we take something that is NOT an Observable and turn it into one, so it can play nice with other Observables. It also means that it can now use <a href="/operators.html">Operators</a>.</p> <h2 id="wrapping-an-ajax-call"><a href="#wrapping-an-ajax-call" aria-hidden="true" class="header-anchor">#</a> Wrapping an ajax call</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> stream <span class="token operator">=</span> Observable<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token parameter">observer</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">let</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

request<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    observer<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    observer<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'error happened'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

  request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    observer<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'error happened'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  request<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

stream<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>Three things we need to do here <code>emit data</code>, <code>handle errors</code> and <code>close the stream</code></p> <h3 id="emit-the-data"><a href="#emit-the-data" aria-hidden="true" class="header-anchor">#</a> Emit the data</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> request<span class="token punctuation">.</span>response <span class="token punctuation">)</span> <span class="token comment">// emit data</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="handle-potential-errors"><a href="#handle-potential-errors" aria-hidden="true" class="header-anchor">#</a> Handle potential errors</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">else</span> <span class="token punctuation">{</span>
  observer<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'error happened'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>and</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  observer<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'error happened'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="close-the-stream"><a href="#close-the-stream" aria-hidden="true" class="header-anchor">#</a> Close the stream</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span> request<span class="token punctuation">.</span>response <span class="token punctuation">)</span>
  observer<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// close stream, as we don't expect more data</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="wrapping-a-speech-audio-api"><a href="#wrapping-a-speech-audio-api" aria-hidden="true" class="header-anchor">#</a> Wrapping a speech audio API</h2> <div class="language-js line-numbers-mode"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">}</span> <span class="token operator">=</span> Rx<span class="token punctuation">;</span>

<span class="token keyword">const</span> speechRecognition$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observable</span><span class="token punctuation">(</span><span class="token parameter">observer</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> speech <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">webkitSpeechRecognition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  speech<span class="token punctuation">.</span><span class="token function-variable function">onresult</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    observer<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  speech<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    speech<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token parameter">text</span> <span class="token operator">=&gt;</span>
  <span class="token keyword">new</span> <span class="token class-name">Observable</span><span class="token punctuation">(</span><span class="token parameter">observer</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> utterance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeechSynthesisUtterance</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    utterance<span class="token punctuation">.</span><span class="token function-variable function">onend</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      observer<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    speechSynthesis<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span>utterance<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> heyClick$ <span class="token operator">=</span> Observable<span class="token punctuation">.</span><span class="token function">fromEvent</span><span class="token punctuation">(</span>button<span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

heyClick$
  <span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> speechRecognition$<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>transcript<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">text</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'I want'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'candy'</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'hi'</span><span class="token punctuation">:</span>
      <span class="token keyword">case</span> <span class="token string">'ice ice'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'baby'</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'hello'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'Is it me you are looking for'</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'make me a sandwich'</span><span class="token punctuation">:</span>
      <span class="token keyword">case</span> <span class="token string">'get me a sandwich'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'do it yo damn self'</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'why are you being so sexist'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'you made me that way'</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`I don't understand: &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">concatMap</span><span class="token punctuation">(</span>say<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h3 id="speech-recognition-stream"><a href="#speech-recognition-stream" aria-hidden="true" class="header-anchor">#</a> Speech recognition stream</h3> <p>This activates the microphone in the browser and records us</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> speechRecognition$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observable</span><span class="token punctuation">(</span><span class="token parameter">observer</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> speech <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">webkitSpeechRecognition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  speech<span class="token punctuation">.</span><span class="token function-variable function">onresult</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
   observer<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  speech<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    speech<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>This essentially sets up the speech recognition API. We wait for one response and after that we complete the stream, much like the first example with AJAX.</p> <p>Note also that a function is defined for cleanup</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  speech<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>so that we can call <code>speechRecognition.unsubscribe()</code> to clean up resources</p> <h3 id="speech-synthesis-utterance-say"><a href="#speech-synthesis-utterance-say" aria-hidden="true" class="header-anchor">#</a> Speech synthesis utterance, <code>say</code></h3> <p>This is responsible for uttering what you want it to utter ( say ).</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">say</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Observable</span><span class="token punctuation">(</span><span class="token parameter">observer</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> utterance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpeechSynthesisUtterance</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  utterance<span class="token punctuation">.</span><span class="token function-variable function">onend</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    observer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    observer<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  speechSynthesis<span class="token punctuation">.</span><span class="token function">speak</span><span class="token punctuation">(</span>utterance<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="main-stream-hey"><a href="#main-stream-hey" aria-hidden="true" class="header-anchor">#</a> main stream <code>hey$</code></h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>heyClick$
  <span class="token punctuation">.</span><span class="token function">switchMap</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> speechRecognition$<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>transcript<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">text</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'I want'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'candy'</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'hi'</span><span class="token punctuation">:</span>
      <span class="token keyword">case</span> <span class="token string">'ice ice'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'baby'</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'hello'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'Is it me you are looking for'</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'make me a sandwich'</span><span class="token punctuation">:</span>
      <span class="token keyword">case</span> <span class="token string">'get me a sandwich'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'do it yo damn self'</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'why are you being so sexist'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'you made me that way'</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`I don't understand: &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">concatMap</span><span class="token punctuation">(</span>say<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>Logic should be read as follows</p> <ul><li><code>heyClick$</code> is activated on a click on a button.</li> <li><code>speechRecognition</code> is listening for what we say and sends that result into - <code>heyClick$</code> where the switching logic determines an appropriate response that is uttered by <code>say</code> Observable.</li></ul> <p>all credit due to @ladyleet and @benlesh</p> <h2 id="summary"><a href="#summary" aria-hidden="true" class="header-anchor">#</a> Summary</h2> <p>One easier Ajax wrapping and one a little more advanced Speech API has been wrapped into an Observable. The mechanics are still the same though:</p> <ol><li>where data is emitted, add a call to <code>next()</code></li> <li>if there is NO more data to emit call <code>complete</code></li> <li>if there is a need for it, define a function that can be called upon <code>unsubscribe()</code></li> <li>Handle errors through calling <code>.error()</code> in the appropriate place. (only done in the first example)</li></ol></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.64faaba4.js" defer></script><script src="/assets/js/10.da81cb77.js" defer></script><script src="/assets/js/77.58b772a8.js" defer></script>
  </body>
</html>
